---
title: "figures.Rmd"
author: "Stephen Roecker"
date: "10/20/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

# plot example of methods

```{r}

library(soilDB)
library(aqp)
library(mpspline2)
library(ggplot)


vars <- c("pedon_key", "hzn_top", "hzn_bot", "ph_h2o")
int <- c(0, 30, 100, 200)
mid <- round(rowMeans(cbind(int, c(int[-1], NA))))
int2 <- sort(c(mid, mid + 1))


f    <- fetchKSSL("Miami")
idx  <- site(f)$pedon_key %in% "12696"
test <- f[idx, ]
test2 <- segment(test, intervals = 0:150)
test_df <- cbind(method = "original data", horizons(test2)[vars[-3]])


# point estimate
f_p <- segment(test, intervals = int2)
idx <- which(horizons(f_p)$hzn_top %in% mid)
f_p <- f_p[, idx]
pd_df <- cbind(method = "point sample", horizons(f_p)[vars[-3]])


# spline estimate
test_s <- mpspline(horizons(test)[vars], var_name = "ph_h2o", d = int, vlow = min(test$ph_h2o), vhigh = max(test$ph_h2o))
mps_df <- data.frame(method = "spline estimate",
                     pedon_key = test_s[[1]]$pedon_key, 
                     hzn_top   = 1:length(test_s[[1]]$est_1cm), 
                     ph_h2o      = test_s[[1]]$est_1cm
                     )
# mps_df <- mps_df[mps_df$hzn_top %in% mid, vars[-3]]


# combine
test_c <- rbind(test_df, pd_df, mps_df)


# plot
dp_gg <- ggplot(test_df, aes(y = ph_h2o, x = hzn_top, col = method)) + 
  geom_line(lwd = 1.5) +
  geom_line(data = mps_df, aes(y = ph_h2o, x = hzn_top, method = "spline"), lwd = 1.5, linetype = "longdash") +
  # geom_point(data = pd_df, aes(y = ph_h2o, x = hzn_top), size = 3.5) +
  scale_x_continuous(breaks = int) +
  scale_color_manual(values = c("blue", "orange")) +
  coord_flip(xlim = c(150, 0)) + 
  #xlim(150, 0) +
  xlab("depth interval (cm)") + ylab("pH") +
  ggtitle("Depth plot") + 
  theme_bw()
ggsave(dp_gg, filename = "test.png", device = "png", width = 6, height = 5)

```
